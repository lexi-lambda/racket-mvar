<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>M-vars: Synchronized Boxes</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="autobib.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">M-<wbr></wbr>vars:<span class="mywbr"> &nbsp;</span> Synchronized Boxes</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._guarantees%29" class="tocviewlink" data-pltdoc="x">Guarantees</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._core-operations%29" class="tocviewlink" data-pltdoc="x">Core Operations</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._derived-operations%29" class="tocviewlink" data-pltdoc="x">Derived Operations</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._contracts%29" class="tocviewlink" data-pltdoc="x">Contracts</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._chaperones-and-impersonators%29" class="tocviewlink" data-pltdoc="x">Chaperones and Impersonators</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._versus-syncvar%29" class="tocviewlink" data-pltdoc="x">Comparison with <span class="RktModLink"><span class="RktSym">syncvar</span></span></a></td></tr><tr><td align="right"></td><td><a href="#%28part._doc-bibliography%29" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.M-vars__.Synchronized_.Boxes%29" class="tocsubseclink" data-pltdoc="x">M-<wbr></wbr>vars:<span class="mywbr"> &nbsp;</span> Synchronized Boxes</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._guarantees%29" class="tocsubseclink" data-pltdoc="x">Guarantees</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._ordering-and-fairness%29" class="tocsubseclink" data-pltdoc="x">Ordering and Fairness</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._atomicity%29" class="tocsubseclink" data-pltdoc="x">Atomicity</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._thread-safety%29" class="tocsubseclink" data-pltdoc="x">Thread Safety</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._core-operations%29" class="tocsubseclink" data-pltdoc="x">Core Operations</a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>mvar</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>put!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>try-<wbr></wbr>put!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21-evt%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>put!-<wbr></wbr>evt</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>take!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>try-<wbr></wbr>take!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21-evt%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>take!-<wbr></wbr>evt</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>peek</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>try-<wbr></wbr>peek</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek-evt%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>peek-<wbr></wbr>evt</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>empty?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty-evt%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>empty-<wbr></wbr>evt</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._derived-operations%29" class="tocsubseclink" data-pltdoc="x">Derived Operations</a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-swap%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>swap!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar-<wbr></wbr>update!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">call-<wbr></wbr>with-<wbr></wbr>mvar</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">call-<wbr></wbr>with-<wbr></wbr>mvar!</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._contracts%29" class="tocsubseclink" data-pltdoc="x">Contracts</a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mvar/<span class="mywbr"> &nbsp;</span>c</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._chaperones-and-impersonators%29" class="tocsubseclink" data-pltdoc="x">Chaperones and Impersonators</a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._impersonate-mvar%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">impersonate-<wbr></wbr>mvar</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._chaperone-mvar%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">chaperone-<wbr></wbr>mvar</span></span></a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._versus-syncvar%29" class="tocsubseclink" data-pltdoc="x">Comparison with <span class="RktModLink"><span class="RktSym">syncvar</span></span></a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._doc-bibliography%29" class="tocsubseclink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.14</span></div><h2 class="heading"><a name="(part._.M-vars__.Synchronized_.Boxes)"></a><a name="(mod-path._data/mvar)"></a>M-vars: Synchronized Boxes<span class="button-group"><a href="#(part._.M-vars__.Synchronized_.Boxes)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Alexis King &lt;<a href="mailto:lexi.lambda@gmail.com">lexi.lambda@gmail.com</a>&gt;</p></span></div><p><div class="SIntrapara"></div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>The source of this manual is available on <a href="https://github.com/lexi-lambda/racket-mvar/blob/master/mvar-doc/scribblings/data/mvar.scrbl">GitHub.</a></p></blockquote></blockquote></blockquote></div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/mvar-lib" title="Install this package using `raco pkg install mvar-lib`"><span class="stt">mvar-lib</span></a></span></td></tr></table></div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>M-vars originate in Haskell, where they are known as <span class="RktSym">MVar</span><span class="RktMeta"></span>s. This library is based on the <a href="https://hackage.haskell.org/package/base-4.19.0.0/docs/Control-Concurrent-MVar.html">modern API provided by GHC</a>, which differs in some details from their original presentation in <span class="Autobibref"><a href="#%28autobib._.Simon._.Peyton._.Jones%2C._.Andrew._.Gordon%2C._and._.Sigbjorn._.Finne.Concurrent._.Haskell.Principles._of._.Programming._.Languages._%28.P.O.P.L%291996doi~3a10..1145%2F237721..237794%29" class="AutobibLink" data-pltdoc="x">Peyton Jones et al<span class="Sendabbrev">.</span></a>&nbsp;(<a href="#%28autobib._.Simon._.Peyton._.Jones%2C._.Andrew._.Gordon%2C._and._.Sigbjorn._.Finne.Concurrent._.Haskell.Principles._of._.Programming._.Languages._%28.P.O.P.L%291996doi~3a10..1145%2F237721..237794%29" class="AutobibLink" data-pltdoc="x">1996</a>)</span>. Most notably, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> on a full M-var blocks (instead of raising an exception), and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> is atomic.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">An <a name="(tech._m._var)"></a><span style="font-style: italic">M-var</span> is a mutable data structure useful in concurrent programs. Like a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a>, an M-var is a mutable reference cell that can hold a single value. Unlike a box, an M-var can also be <a name="(tech._empty)"></a><span style="font-style: italic">empty</span>, holding no value at all. When a value is placed into an empty M-var using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, the M-var becomes <a name="(tech._full)"></a><span style="font-style: italic">full</span>, and it remains full until the value is removed using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span>. If a thread attempts to put a value into an M-var that is already full, the thread waits until the M-var is emptied. Conversely, if a thread attempts to take a value from an M-var that is currently empty, it waits until the M-var is filled.</div><div class="SIntrapara">It is also possible to atomically read the contents of a full M-var without removing its value using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span>. Like <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span>, using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> on an empty M-var waits until it is filled. Each operation also comes in a polling variant: <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-put!</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span>, and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span> always return immediately and simply fail instead of blocking. For maximum flexibility, M-vars can also be combined with other <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable events</span></a> using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-put!-evt</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-take!-evt</a></span>, and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-peek-evt</a></span>.</div><div class="SIntrapara"><p><div class="SIntrapara">The blocking behavior of the M-var operations makes M-vars a remarkably flexible building block in concurrent programs, as they are effectively a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528tech._semaphore%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">semaphore</span></a>, and <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=channel.html%23%2528tech._channel%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">channel</span></a> rolled into one. Even a single M-var can serve numerous functions:
</div><div class="SIntrapara"><ul><li><p>If separate processes are tasked with filling and emptying an M-var, it behaves like an <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=async-channel.html%23%2528tech._asynchronous._channel%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">asynchronous channel</span></a> with a buffer size of 1. Producers use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> to send a value, and consumers use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> to receive a value.</p></li><li><p>If an M-var is normally kept full, it behaves like a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a> protected by a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528tech._semaphore%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">semaphore</span></a>. Readers use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> and do not block each other. Writers use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> to acquire the lock and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> to both update the value and release the lock.</p></li><li><p>If an M-var is normally kept empty, it behaves like a <a href="https://en.wikipedia.org/wiki/Monitor_(synchronization)#Nonblocking_condition_variables">nonblocking, broadcast condition variable</a>. <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> is used to wait on the condition, and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> followed immediately by <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> is used to notify waiters.</p></li><li><p>If an M-var starts empty, is filled exactly once, and subsequently remains full, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-peek-evt</a></span> can be used to obtain a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> that remains permanently <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready for synchronization</span></a> once it has been signaled.</p></li></ul></div><div class="SIntrapara">This list is far from exhaustive, and multiple M-vars used in concert can be even more flexible.</div></p></div></p><h3 class="heading">1<tt>&nbsp;</tt><a name="(part._guarantees)"></a>Guarantees<span class="button-group"><a href="#(part._guarantees)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><h4 class="heading">1.1<tt>&nbsp;</tt><a name="(part._ordering-and-fairness)"></a>Ordering and Fairness<span class="button-group"><a href="#(part._ordering-and-fairness)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-var</span></a> synchronization is <a name="(tech._fair)"></a><span style="font-style: italic">fair</span>: if a thread is blocked on an M-var operation, and opportunities for the operation to complete occur infinitely often, the operation is guaranteed to eventually complete. However, the precise order in which threads blocked on a call to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> or <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> are woken up is not guaranteed.</p><p>If a thread is blocked on a call to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span>, the call is guaranteed to complete the next time the M-var is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">filled</span></a>, even if another thread is blocked on a call to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> on the same M-var. In other words, whenever <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> compete to read the next value of an <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a> M-var, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> always wins. Since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> is not exclusive&#8212;that is, it does not preclude another thread from reading the same M-var after it completes&#8212;this preference for <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> ensures that the maximum number of threads are woken up each time an M-var is filled.</p><h4 class="heading">1.2<tt>&nbsp;</tt><a name="(part._atomicity)"></a>Atomicity<span class="button-group"><a href="#(part._atomicity)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>All M-var <a href="#%28tech._core._operation%29" class="techoutside" data-pltdoc="x"><span class="techinside">core operations</span></a> are <a name="(tech._atomic)"></a><span style="font-style: italic">atomic</span>: so long as their executing thread is not killed or suspended (see <a href="#%28part._thread-safety%29" data-pltdoc="x">Thread Safety</a>), either none or all of their effects will take place. This atomicity is guaranteed regardless of the way in which the M-var is used.</p><p>In contrast, <a href="#%28tech._derived._operation%29" class="techoutside" data-pltdoc="x"><span class="techinside">derived operations</span></a> internally perform multiple core operations in sequence, and those sequences are <span class="emph">not</span> intrinsically atomic. However, all derived operations currently provided by this library offer a weaker form of atomicity: they rely on the common M-var usage pattern of treating the M-var like a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528tech._semaphore%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">semaphore</span></a>-protected <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a>, where each use of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> is preceded by a use of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> to acquire exclusive access. This exclusive locking discipline ensures that derived operations are atomic with respect to the M-var&#8217;s state&#8212;<wbr></wbr>each operation constitutes a non-overlapping &#8220;transaction&#8221; that is always fully committed or fully rolled back&#8212;<wbr></wbr>but following the pattern correctly is the programmer&#8217;s responsibility.</p><h4 class="heading">1.3<tt>&nbsp;</tt><a name="(part._thread-safety)"></a>Thread Safety<span class="button-group"><a href="#(part._thread-safety)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a> are a concurrent data structure, so all M-var operations are naturally thread-safe. Furthermore, they are also <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">break</span></a>-safe: if a thread is interrupted via <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._break-thread%2529%2529" class="RktValLink Sq" data-pltdoc="x">break-thread</a></span> while executing any M-var operation, its <a href="#%28part._atomicity%29" data-pltdoc="x">atomicity</a> guarantees will not be compromised, and the M-var will always remain in a valid state.</p><p>However, M-vars are <span class="emph">not</span> kill-safe. If a thread is killed via <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._kill-thread%2529%2529" class="RktValLink Sq" data-pltdoc="x">kill-thread</a></span> while executing any M-var operation (including <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span>), the operation&#8217;s effects may only partially complete, and the M-var may be permanently left in an invalid state. In a similar vein, if a thread is suspended via <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._thread-suspend%2529%2529" class="RktValLink Sq" data-pltdoc="x">thread-suspend</a></span> while executing any M-var operation, the operation may only partially complete, and the M-var may become temporarily unusable until the thread is resumed.</p><p>M-var operations also cannot safely be called in <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=foreign&amp;rel=Atomic_Execution.html%23%2528tech._atomic._mode%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">atomic mode</span></a>. Even non-blocking operations like <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span> may require polling events, which can lead to a deadlock if atomic mode is active.</p><h3 class="heading">2<tt>&nbsp;</tt><a name="(part._core-operations)"></a>Core Operations<span class="button-group"><a href="#(part._core-operations)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>This section documents the complete list of <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-var</span></a> <a name="(tech._core._operation)"></a><span style="font-style: italic">core operations</span>. All core operations are primitive (they cannot be derived from other operations) and <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a> (but not kill-safe; see <a href="#%28part._thread-safety%29" data-pltdoc="x">Thread Safety</a>).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._make-mvar))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-mvar</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-mvar</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Creates and returns a new <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-var</span></a>. If called with no arguments, the returned M-var is initially <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>. If called with one argument, the returned M-var is initially <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a> and contains <span class="RktVar">v</span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: empty&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 42&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar~3f))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is an <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-var</span></a>, otherwise returns <span class="RktVal">#f</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-put!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-put!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">v</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Fills <span class="RktVar">mv</span> with the value <span class="RktVar">v</span>. If <span class="RktVar">mv</span> is already <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> blocks until it is <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">emptied</span></a>.</div></p><p>If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting on <span class="RktVar">mv</span>. If breaks are disabled when <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> is called, then either <span class="RktVar">mv</span> is filled or an <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3abreak%2529%2529" class="RktValLink Sq" data-pltdoc="x">exn:break</a></span> exception is raised, but not both.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: empty&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 42&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-try-put!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-try-put!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-put!</a></span> <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">fills</span></a> it and returns <span class="RktVal">#t</span>. Otherwise, returns <span class="RktVal">#f</span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: empty&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-put!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 1&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-put!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 1&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-put!-evt))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21-evt%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-put!-evt</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">evt?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> for use with <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync</a></span>. The event is <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready for synchronization</span></a> when <span class="RktVar">mv</span> is <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, and if the event is selected, <span class="RktVar">mv</span> is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">filled</span></a> with <span class="RktVar">v</span>. The event&#8217;s <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronization._result%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronization result</span></a> is the event itself.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-take!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-take!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Removes the value contained in <span class="RktVar">mv</span> and returns it. If <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> blocks until it is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">filled</span></a>.</div></p><p>If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting on <span class="RktVar">mv</span>. If breaks are disabled when <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> is called, then either <span class="RktVar">mv</span> is emptied or an <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3abreak%2529%2529" class="RktValLink Sq" data-pltdoc="x">exn:break</a></span> exception is raised, but not both.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 42&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: empty&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-try-take!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-try-take!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktOpt">[</span><span class="RktVar">fail</span><span class="RktOpt">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fail</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._failure-result%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">failure-result/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">mv</span> is currently <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span> removes its value and returns it. If <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, <span class="RktVar">fail</span> determines the result:
</div><div class="SIntrapara"><ul><li><p>If <span class="RktVar">fail</span> is a procedure, it is applied to zero arguments in tail position to produce the result.</p></li><li><p>Otherwise, <span class="RktVar">fail</span> is returned as the result.</p></li></ul></div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 42&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: empty&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-take!-evt))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21-evt%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-take!-evt</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">evt?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> for use with <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync</a></span>. The event is <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready for synchronization</span></a> when <span class="RktVar">mv</span> is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>. If the event is selected, <span class="RktVar">mv</span> is <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">emptied</span></a>, and the removed value is the event&#8217;s <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronization._result%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronization result</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-peek))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-peek</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the value contained in <span class="RktVar">mv</span>. If <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> blocks until it is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">filled</span></a>.</div></p><p>If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting on <span class="RktVar">mv</span>. If breaks are disabled when <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> is called, then either <span class="RktVar">mv</span> is emptied or an <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3abreak%2529%2529" class="RktValLink Sq" data-pltdoc="x">exn:break</a></span> exception is raised, but not both.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 42&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr></table></blockquote></div></p><p>Note that <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> followed immediately by a use of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> to replace the taken value is <span class="emph">not</span> equivalent to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span>: since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empties</span></a> the M-var, another thread may <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">fill</span></a> it with a different value before the removed value can be replaced. In comparison, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> does not remove the value from the M-var, so it is guaranteed to be atomic. Additionally, a call to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> is guaranteed to return as soon as the M-var is filled, while <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> is not; see <a href="#%28part._ordering-and-fairness%29" data-pltdoc="x">Ordering and Fairness</a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-try-peek))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-try-peek</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktOpt">[</span><span class="RktVar">fail</span><span class="RktOpt">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fail</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._failure-result%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">failure-result/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">mv</span> is currently <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span> returns its value. If <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, <span class="RktVar">fail</span> determines the result in the same was as for <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-peek-evt))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek-evt%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-peek-evt</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">evt?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> for use with <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync</a></span>. The event is <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready for synchronization</span></a> when <span class="RktVar">mv</span> is <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>, and its value is the event&#8217;s <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronization._result%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronization result</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-empty~3f))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-empty?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">mv</span> is currently <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, otherwise returns <span class="RktVal">#f</span>.</div></p><p>This operation is provided for completeness, but note that if <span class="RktVar">mv</span> has multiple readers, the result of this function could become out of date the moment it returns. It is therefore very rarely the right choice, and it is almost always better to use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-put!</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-try-take!</a></span>, or <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-try-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-try-peek</a></span>, instead.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-empty-evt))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty-evt%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-empty-evt</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">evt?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> for use with <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync</a></span>. The event is <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready for synchronization</span></a> when <span class="RktVar">mv</span> is <a href="#%28tech._empty%29" class="techoutside" data-pltdoc="x"><span class="techinside">empty</span></a>, and its <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronization._result%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronization result</span></a> is the event itself.</div></p><p>Like <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty~3f%29%29" class="RktValLink" data-pltdoc="x">mvar-empty?</a></span>, this operation should be used very carefully: even if the event is selected, another thread might fill <span class="RktVar">mv</span> the instant that <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync</a></span> returns, so it is almost always better to use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-put!-evt</a></span>, instead. However, in programs where <span class="RktVar">mv</span> only has a single writer, it can rarely be useful, so it is provided for completeness.</p><h3 class="heading">3<tt>&nbsp;</tt><a name="(part._derived-operations)"></a>Derived Operations<span class="button-group"><a href="#(part._derived-operations)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>The bindings documented in this section are <a name="(tech._derived._operation)"></a><span style="font-style: italic">derived operations</span>, which codify some common patterns that arise when an <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-var</span></a> is used like a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528tech._semaphore%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">semaphore</span></a>-protected <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a>. Since they are implemented as sequences of <a href="#%28tech._core._operation%29" class="techoutside" data-pltdoc="x"><span class="techinside">core operations</span></a>, they are <span class="emph">not</span> intrinsically <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a>. Instead, atomicity is enforced through a locking discipline: each operation expects to receive an M-var that is normally kept <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>, and it uses <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> to acquire an exclusive lock on its contents. When the operation returns, it uses <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> to simultaneously update the contents and release the lock.</p><p>Since all of the bindings in this section follow this locking discipline, an easy recipe to ensure atomicity is to never use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> or <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> directly on any M-var used as a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528tech._semaphore%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">semaphore</span></a>-protected <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528tech._box%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">box</span></a>. Doing this comes at the risk of accidentally failing to either acquire or release the lock, which is especially easy to do if the critical section fails with an exception or is interrupted by a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">break</span></a>. The higher-level, derived operations documented in this section make those accidents impossible, so they should be preferred whenever the lower-level, channel-style operations are not needed.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-swap!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-swap%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-swap!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">v</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Takes a value from <span class="RktVar">mv</span>, puts <span class="RktVar">v</span> into <span class="RktVar">mv</span>, then returns the taken value. If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting to take from <span class="RktVar">mv</span>.</div></p><p>Since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-swap%21%29%29" class="RktValLink" data-pltdoc="x">mvar-swap!</a></span> is implemented using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> followed by <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, it is not intrinsically <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a>. To ensure atomicity, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-swap%21%29%29" class="RktValLink" data-pltdoc="x">mvar-swap!</a></span> should only be used on <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a> that follow <a href="#%28part._derived-operations%29" data-pltdoc="x">the required locking discipline</a>.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">old</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-swap%21%29%29" class="RktValLink" data-pltdoc="x">mvar-swap!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">new</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'old</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 'new&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar-update!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar-update!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">update-proc</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">update-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Takes a value from <span class="RktVar">mv</span>, applies <span class="RktVar">update-proc</span> to the taken value, then puts the result into <span class="RktVar">mv</span>. If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting to take from <span class="RktVar">mv</span>.</div></p><p>Since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="RktValLink" data-pltdoc="x">mvar-update!</a></span> is implemented using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> followed by <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, it is not intrinsically <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a>. To ensure atomicity, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="RktValLink" data-pltdoc="x">mvar-update!</a></span> should only be used on <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a> that follow <a href="#%28part._derived-operations%29" data-pltdoc="x">the required locking discipline</a>.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="RktValLink" data-pltdoc="x">mvar-update!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktVar">mv</span></td></tr><tr><td><p><span class="RktRes">#&lt;mvar: 1&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._call-with-mvar))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValDef RktValLink" data-pltdoc="x">call-with-mvar</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">body-proc</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529" class="RktStxLink Sq" data-pltdoc="x">any</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">body-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Takes a value from <span class="RktVar">mv</span>, applies <span class="RktVar">body-proc</span> to the taken value, then puts the taken value back into <span class="RktVar">mv</span>. The result of <span class="RktVar">body-proc</span> is the result of the <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> call. If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting to take from <span class="RktVar">mv</span>.</div></p><p><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> is useful if <span class="RktVar">mv</span> contains a handle to a shared resource that cannot be used by more than one thread at a time. For example, <span class="RktVar">mv</span> might hold an <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=ports.html%23%2528tech._output._port%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">output port</span></a>, and a writer thread might use <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> to obtain exclusive access to the port while it writes a packet, which must not be interleaved with other writes. Once the packet has been written and <span class="RktVar">body-proc</span> returns, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> puts the output port back in <span class="RktVar">mv</span>, making it available for acquisition by some other thread.</p><p>Since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> is implemented using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> followed by <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, it is not intrinsically <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a>. To ensure atomicity, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> should only be used on <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a> that follow <a href="#%28part._derived-operations%29" data-pltdoc="x">the required locking discipline</a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._call-with-mvar!))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">call-with-mvar!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">body-proc</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:enable-break?</span><span class="hspace">&nbsp;</span><span class="RktVar">enable-break?</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529" class="RktStxLink Sq" data-pltdoc="x">any</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">body-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">...+</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">enable-break?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Takes a value from <span class="RktVar">mv</span> and applies <span class="RktVar">body-proc</span> to the taken value, which must return at least one result. The first result is put into <span class="RktVar">mv</span>, and the other results are the result of the <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar!</a></span> call. If <span class="RktVar">enable-break?</span> is not <span class="RktVal">#f</span>, <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> are explicitly enabled while waiting to take from <span class="RktVar">mv</span>.</div></p><p>In other words, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar!</a></span> is effectively a combination of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-update%21%29%29" class="RktValLink" data-pltdoc="x">mvar-update!</a></span>: <span class="RktVar">body-proc</span> determines both the value put back into <span class="RktVar">mv</span> and the result (or results) of the overall call.</p><p>Since <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar!</a></span> is implemented using <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> followed by <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, it is not intrinsically <a href="#%28tech._atomic%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic</span></a>. To ensure atomicity, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._call-with-mvar%21%29%29" class="RktValLink" data-pltdoc="x">call-with-mvar!</a></span> should only be used on <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a> that follow <a href="#%28part._derived-operations%29" data-pltdoc="x">the required locking discipline</a>.</p><h3 class="heading">4<tt>&nbsp;</tt><a name="(part._contracts)"></a>Contracts<span class="button-group"><a href="#(part._contracts)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._mvar/c))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar%2Fc%29%29" class="RktValDef RktValLink" data-pltdoc="x">mvar/c</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">in-ctc</span><span class="hspace">&nbsp;</span><span class="RktOpt">[</span><span class="RktVar">out-ctc</span><span class="RktOpt">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">contract?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">in-ctc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">contract?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">out-ctc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">contract?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVar">in-ctc</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contracts.html%23%2528tech._contract%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">contract</span></a> that recognizes <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a>. Values written to the M-var must match <span class="RktVar">in-ctc</span>, and values read from the M-var must match <span class="RktVar">out-ctc</span>. Usually, <span class="RktVar">in-ctc</span> and <span class="RktVar">out-ctc</span> are the same (which is the default if <span class="RktVar">out-ctc</span> is not provided), but supplying <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._none%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">none/c</a></span> for one of the arguments can be useful to restrict the client of the contract to reading from or writing to the M-var.</div></p><p>If <span class="RktVar">in-ctc</span> and <span class="RktVar">out-ctc</span> are both <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contracts.html%23%2528tech._chaperone._contract%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">chaperone contracts</span></a>, the result will be a chaperone contract. Otherwise, the result will be an <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contracts.html%23%2528tech._impersonator._contract%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">impersonator contract</span></a>.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=attaching-contracts-to-values.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fregion..rkt%2529._define%252Fcontract%2529%2529" class="RktStxLink Sq" data-pltdoc="x">define/contract</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar%2Fc%29%29" class="RktValLink" data-pltdoc="x">mvar/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._make-mvar%29%29" class="RktValLink" data-pltdoc="x">make-mvar</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mv</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not-an-integer</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">mv: contract violation</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: exact-integer?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">given: 'not-an-integer</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: a value written to</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(mvar/c exact-integer?)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: (definition mv)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: top-level</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:1:0</span></p></td></tr></table></blockquote></div></p><h3 class="heading">5<tt>&nbsp;</tt><a name="(part._chaperones-and-impersonators)"></a>Chaperones and Impersonators<span class="button-group"><a href="#(part._chaperones-and-impersonators)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._impersonate-mvar))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._impersonate-mvar%29%29" class="RktValDef RktValLink" data-pltdoc="x">impersonate-mvar</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:get</span><span class="hspace">&nbsp;</span><span class="RktVar">get-proc</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:put</span><span class="hspace">&nbsp;</span><span class="RktVar">put-proc</span><span class="RktOpt">]</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">prop</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">prop-val</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktMeta">...</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">get-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">put-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">prop</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=chaperones.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._impersonator-property%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">impersonator-property?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">prop-val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns an <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=chaperones.html%23%2528tech._impersonator%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">impersonator</span></a> of <span class="RktVar">mv</span>.</div></p><p>If <span class="RktVar">get-proc</span> is not <span class="RktVal">#f</span>, the result of each use of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span> or <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> on the impersonator is redirected through <span class="RktVar">get-proc</span>, which must produce a replacement value. Likewise, if <span class="RktVar">put-proc</span> is not <span class="RktVal">#f</span>, the value stored by each use of <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> is redirected through <span class="RktVar">put-proc</span>.</p><p>Pairs of <span class="RktVar">prop</span> and <span class="RktVar">prop-val</span> (the number of by-position arguments to <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._impersonate-mvar%29%29" class="RktValLink" data-pltdoc="x">impersonate-mvar</a></span> must be odd) add or override <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=chaperones.html%23%2528tech._impersonator._property%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">impersonator property</span></a> values of <span class="RktVar">mv</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._data/mvar..rkt)._chaperone-mvar))"></a><span title="Provided from: data/mvar | Package: mvar-lib"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._chaperone-mvar%29%29" class="RktValDef RktValLink" data-pltdoc="x">chaperone-mvar</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mv</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:get</span><span class="hspace">&nbsp;</span><span class="RktVar">get-proc</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:put</span><span class="hspace">&nbsp;</span><span class="RktVar">put-proc</span><span class="RktOpt">]</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">prop</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">prop-val</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktMeta">...</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mv</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar~3f%29%29" class="RktValLink" data-pltdoc="x">mvar?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">get-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">put-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">prop</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=chaperones.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._impersonator-property%7E3f%2529%2529" class="RktValLink Sq" data-pltdoc="x">impersonator-property?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">prop-val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._impersonate-mvar%29%29" class="RktValLink" data-pltdoc="x">impersonate-mvar</a></span>, but produces a <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=chaperones.html%23%2528tech._chaperone%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">chaperone</span></a> of <span class="RktVar">mv</span>, and the <span class="RktVar">get-proc</span> and <span class="RktVar">put-proc</span> procedures must return chaperones of their arguments.</div></p><h3 class="heading">6<tt>&nbsp;</tt><a name="(part._versus-syncvar)"></a>Comparison with <a href="https://docs.racket-lang.org/local-redirect/index.html?tag=%28mod-path._.%27syncvar.%27%29" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syncvar</span></a><span class="button-group"><a href="#(part._versus-syncvar)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><div class="SIntrapara">The <a href="https://docs.racket-lang.org/local-redirect/index.html?tag=%28mod-path._.%27syncvar%2Fmvar.%27%29" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syncvar/mvar</span></a> library predates <a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a> and also provides an implementation of <a href="#%28tech._m._var%29" class="techoutside" data-pltdoc="x"><span class="techinside">M-vars</span></a>. The libraries are quite similar, but <a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a> provides several additional features:
</div><div class="SIntrapara"><ul><li><p>In <a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span> blocks when applied to an M-var that is already <a href="#%28tech._full%29" class="techoutside" data-pltdoc="x"><span class="techinside">full</span></a>; in <a href="https://docs.racket-lang.org/local-redirect/index.html?tag=%28mod-path._.%27syncvar%2Fmvar.%27%29" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syncvar/mvar</span></a>, it raises an error. (The error-raising behavior appeared in the original design<span class="Autobibref">&nbsp;(<a href="#%28autobib._.Simon._.Peyton._.Jones%2C._.Andrew._.Gordon%2C._and._.Sigbjorn._.Finne.Concurrent._.Haskell.Principles._of._.Programming._.Languages._%28.P.O.P.L%291996doi~3a10..1145%2F237721..237794%29" class="AutobibLink" data-pltdoc="x">Peyton Jones et al<span class="Sendabbrev">.</span></a> <a href="#%28autobib._.Simon._.Peyton._.Jones%2C._.Andrew._.Gordon%2C._and._.Sigbjorn._.Finne.Concurrent._.Haskell.Principles._of._.Programming._.Languages._%28.P.O.P.L%291996doi~3a10..1145%2F237721..237794%29" class="AutobibLink" data-pltdoc="x">1996</a>)</span>, but the blocking behavior turned out to be significantly more useful.)</p></li><li><p><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a> provides <a href="#%28part._contracts%29" data-pltdoc="x">contracts</a>, <a href="#%28part._chaperones-and-impersonators%29" data-pltdoc="x">chaperones, and impersonators</a> on M-vars, while <a href="https://docs.racket-lang.org/local-redirect/index.html?tag=%28mod-path._.%27syncvar%2Fmvar.%27%29" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syncvar/mvar</span></a> does not.</p></li><li><p>In <a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-put%21%29%29" class="RktValLink" data-pltdoc="x">mvar-put!</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-take%21%29%29" class="RktValLink" data-pltdoc="x">mvar-take!</a></span>, and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> accept an <span class="RktPn">#:enable-break?</span> keyword argument to allow <a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a> to be delivered while blocked even if they are disabled in the enclosing context. <a href="https://docs.racket-lang.org/local-redirect/index.html?tag=%28mod-path._.%27syncvar%2Fmvar.%27%29" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syncvar/mvar</span></a> does not, though <span class="RktSym"><a href="https://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%252Fenable-break%2529%2529" class="RktValLink Sq" data-pltdoc="x">sync/enable-break</a></span> can be used as an alternative.</p></li><li><p><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a> provides stronger guarantees for <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-peek%29%29" class="RktValLink" data-pltdoc="x">mvar-peek</a></span> (see <a href="#%28part._ordering-and-fairness%29" data-pltdoc="x">Ordering and Fairness</a>).</p></li><li><p><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">data/mvar</span></a> provides the <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty~3f%29%29" class="RktValLink" data-pltdoc="x">mvar-empty?</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._data%2Fmvar..rkt%29._mvar-empty-evt%29%29" class="RktValLink" data-pltdoc="x">mvar-empty-evt</a></span> operations (though they are of admittedly limited usefulness).</p></li></ul></div><div class="SIntrapara">For most users, the first two bullets in the above list will likely be the only ones that matter.</div></p><h3 class="heading"><a name="(part._doc-bibliography)"></a>Bibliography<span class="button-group"><a href="#(part._doc-bibliography)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><table cellspacing="0" cellpadding="0" class="AutoBibliography"><tr><td><p><span class="Autobibtarget"><a name="(autobib._.Simon._.Peyton._.Jones,._.Andrew._.Gordon,._and._.Sigbjorn._.Finne.Concurrent._.Haskell.Principles._of._.Programming._.Languages._(.P.O.P.L)1996doi~3a10..1145/237721..237794)"></a><span class="Autobibentry">Simon Peyton Jones, Andrew Gordon, and Sigbjorn Finne. Concurrent Haskell. Principles of Programming Languages (POPL), 1996. <span class="pseudodoi">doi:<a href="https://doi.org/10.1145/237721.237794">10.1145/237721.237794</a></span></span></span></p></td></tr></table></p></div></div><div id="contextindicator">&nbsp;</div></body></html>